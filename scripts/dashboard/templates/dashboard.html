<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOL Trading Dashboard</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Custom Styles -->
    <style>
        body {
            background-color: #121212;
            color: #e0e0e0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .card {
            background-color: #1e1e1e;
            border: 1px solid #333;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .card-header {
            background-color: #2a2a2a;
            border-bottom: 1px solid #333;
            color: #fff;
            font-weight: bold;
        }
        
        .navbar {
            background-color: #272727;
        }
        
        .navbar-brand {
            font-weight: bold;
            color: #2cd0d0;
        }
        
        .alert-card {
            transition: all 0.3s ease;
        }
        
        .alert-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .price-up {
            color: #4caf50;
        }
        
        .price-down {
            color: #f44336;
        }
        
        .signal-badge {
            font-size: 0.8rem;
            padding: 5px 10px;
            border-radius: 20px;
        }
        
        .signal-tradingview {
            background-color: #9c27b0;
            color: white;
        }
        
        .signal-combined {
            background-color: #3f51b5;
            color: white;
        }
        
        .signal-strong {
            background-color: #ff9800;
            color: white;
        }
        
        #priceChart {
            width: 100%;
            height: 400px;
        }
        
        .refresh-icon {
            cursor: pointer;
            color: #2cd0d0;
            margin-left: 10px;
        }
        
        .stats-value {
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .flash-animation {
            animation: flash 2s;
        }
        
        @keyframes flash {
            0% { background-color: rgba(44, 208, 208, 0.5); }
            100% { background-color: transparent; }
        }
        
        .confidence-bar {
            height: 8px;
            border-radius: 4px;
            margin-top: 5px;
            background-color: #333;
        }
        
        .confidence-fill {
            height: 100%;
            border-radius: 4px;
            background-color: #2cd0d0;
        }
        
        .no-signals {
            text-align: center;
            padding: 50px;
            color: #666;
            font-style: italic;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark mb-4">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <img src="https://cryptologos.cc/logos/solana-sol-logo.png" alt="SOL" height="30" class="d-inline-block align-top me-2">
                SOL Trading Dashboard
            </a>
            <div class="d-flex">
                <div class="me-3">
                    <div class="text-muted">Current Price</div>
                    <div class="h4 mb-0" id="currentPrice">$0.00</div>
                </div>
                <div>
                    <div class="text-muted">24h Change</div>
                    <div class="h4 mb-0" id="priceChange">0.00%</div>
                </div>
            </div>
        </div>
    </nav>
    
    <!-- Main Content -->
    <div class="container-fluid">
        <div class="row">
            <!-- Left Column - Chart -->
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span>SOL Price Chart</span>
                        <div>
                            <span id="lastUpdate" class="text-muted me-2">Last updated: Never</span>
                            <i class="refresh-icon" onclick="fetchData()">ðŸ”„</i>
                        </div>
                    </div>
                    <div class="card-body">
                        <canvas id="priceChart"></canvas>
                    </div>
                </div>
                
                <!-- Trading Stats -->
                <div class="card">
                    <div class="card-header">Trading Statistics</div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-md-3">
                                <div class="text-muted">Total Signals</div>
                                <div class="stats-value" id="totalSignals">0</div>
                            </div>
                            <div class="col-md-3">
                                <div class="text-muted">Win Rate</div>
                                <div class="stats-value" id="winRate">0%</div>
                            </div>
                            <div class="col-md-3">
                                <div class="text-muted">Avg Return</div>
                                <div class="stats-value" id="avgReturn">0%</div>
                            </div>
                            <div class="col-md-3">
                                <div class="text-muted">Last Signal</div>
                                <div class="stats-value" id="lastSignal">Never</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Right Column - Signal Alerts -->
            <div class="col-lg-4">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span>Trading Signals</span>
                        <div>
                            <select id="signalFilter" class="form-select form-select-sm" style="width: auto; display: inline-block;">
                                <option value="all">All Signals</option>
                                <option value="TradingView-style">TradingView Style</option>
                                <option value="Combined">Combined</option>
                                <option value="Strong">Strong</option>
                            </select>
                        </div>
                    </div>
                    <div class="card-body" style="max-height: 700px; overflow-y: auto;">
                        <div id="signalAlerts">
                            <div class="no-signals">
                                <p>No trading signals detected yet</p>
                                <p>Signals will appear here when the model detects trading opportunities</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bootstrap and Custom JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Initialize chart
        let priceChart;
        let signals = [];
        let prices = [];
        
        // Set up chart
        function setupChart() {
            const ctx = document.getElementById('priceChart').getContext('2d');
            
            priceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'SOL Price ($)',
                        data: [],
                        borderColor: '#2cd0d0',
                        backgroundColor: 'rgba(44, 208, 208, 0.1)',
                        borderWidth: 2,
                        pointRadius: 0,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'hour',
                                displayFormats: {
                                    hour: 'MM/dd HH:mm'
                                }
                            },
                            ticks: {
                                color: '#999'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.05)'
                            }
                        },
                        y: {
                            ticks: {
                                color: '#999'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.05)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    return `Price: $${context.raw.y.toFixed(2)}`;
                                }
                            }
                        }
                    },
                    interaction: {
                        mode: 'nearest',
                        axis: 'x',
                        intersect: false
                    }
                }
            });
        }
        
        // Fetch data from API
        async function fetchData() {
            try {
                // Get signals
                const signalsResponse = await fetch('/api/signals');
                signals = await signalsResponse.json();
                
                // Get prices
                const pricesResponse = await fetch('/api/prices');
                prices = await pricesResponse.json();
                
                // Get stats
                const statsResponse = await fetch('/api/stats');
                const stats = await statsResponse.json();
                
                // Update UI
                updateChart();
                updateSignals();
                updateStats(stats);
                
                // Update last update time
                document.getElementById('lastUpdate').textContent = `Last updated: ${new Date().toLocaleTimeString()}`;
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }
        
        // Update chart with new data
        function updateChart() {
            if (prices.length === 0) return;
            
            // Format data for chart
            const chartData = prices.map(item => ({
                x: new Date(item.timestamp),
                y: item.price
            }));
            
            // Update chart
            priceChart.data.datasets[0].data = chartData;
            priceChart.update();
            
            // Update current price
            const latestPrice = prices[prices.length - 1].price;
            document.getElementById('currentPrice').textContent = `$${latestPrice.toFixed(2)}`;
            
            // Calculate 24h change if we have enough data
            if (prices.length > 288) { // 288 = 24 hours of 5-minute candles
                const previousPrice = prices[prices.length - 288].price;
                const change = ((latestPrice - previousPrice) / previousPrice) * 100;
                const changeElement = document.getElementById('priceChange');
                
                changeElement.textContent = `${change.toFixed(2)}%`;
                
                if (change >= 0) {
                    changeElement.className = 'h4 mb-0 price-up';
                    changeElement.textContent = `+${changeElement.textContent}`;
                } else {
                    changeElement.className = 'h4 mb-0 price-down';
                }
            }
        }
        
        // Update signal alerts
        function updateSignals() {
            const alertsContainer = document.getElementById('signalAlerts');
            const filterValue = document.getElementById('signalFilter').value;
            
            if (signals.length === 0) {
                alertsContainer.innerHTML = `
                    <div class="no-signals">
                        <p>No trading signals detected yet</p>
                        <p>Signals will appear here when the model detects trading opportunities</p>
                    </div>
                `;
                return;
            }
            
            // Clear no signals message
            if (alertsContainer.querySelector('.no-signals')) {
                alertsContainer.innerHTML = '';
            }
            
            // Sort signals by timestamp (newest first)
            const sortedSignals = [...signals].sort((a, b) => {
                return new Date(b.signal_time) - new Date(a.signal_time);
            });
            
            // Filter signals if needed
            const filteredSignals = filterValue === 'all' ? 
                sortedSignals : 
                sortedSignals.filter(signal => signal.type === filterValue);
            
            // Generate signal cards HTML
            let signalsHTML = '';
            
            if (filteredSignals.length === 0) {
                signalsHTML = `
                    <div class="no-signals">
                        <p>No ${filterValue} signals found</p>
                    </div>
                `;
            } else {
                filteredSignals.forEach(signal => {
                    // Determine signal badge class
                    let badgeClass = 'signal-combined';
                    if (signal.type === 'TradingView-style') {
                        badgeClass = 'signal-tradingview';
                    } else if (signal.type === 'Strong') {
                        badgeClass = 'signal-strong';
                    }
                    
                    // Format time
                    const signalTime = new Date(signal.signal_time);
                    const formattedTime = signalTime.toLocaleString();
                    
                    // Create confidence bars
                    const conf5m = signal.confidence_5m * 100;
                    const conf15m = signal.confidence_15m * 100;
                    const confWeighted = signal.weighted_confidence * 100;
                    
                    signalsHTML += `
                        <div class="card mb-3 alert-card" id="signal-${signal.id}">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <h6 class="mb-1">Signal at $${signal.price.toFixed(2)}</h6>
                                        <p class="text-muted mb-2">${formattedTime}</p>
                                    </div>
                                    <span class="badge signal-badge ${badgeClass}">${signal.type}</span>
                                </div>
                                
                                <div class="mt-3">
                                    <div class="d-flex justify-content-between">
                                        <small>5m Confidence: ${conf5m.toFixed(1)}%</small>
                                        <small>${signal.confidence_5m.toFixed(4)}</small>
                                    </div>
                                    <div class="confidence-bar">
                                        <div class="confidence-fill" style="width: ${Math.min(conf5m * 2.5, 100)}%;"></div>
                                    </div>
                                    
                                    <div class="d-flex justify-content-between mt-2">
                                        <small>15m Confidence: ${conf15m.toFixed(1)}%</small>
                                        <small>${signal.confidence_15m.toFixed(4)}</small>
                                    </div>
                                    <div class="confidence-bar">
                                        <div class="confidence-fill" style="width: ${Math.min(conf15m * 2.5, 100)}%;"></div>
                                    </div>
                                    
                                    <div class="d-flex justify-content-between mt-2">
                                        <small>Weighted: ${confWeighted.toFixed(1)}%</small>
                                        <small>${signal.weighted_confidence.toFixed(4)}</small>
                                    </div>
                                    <div class="confidence-bar">
                                        <div class="confidence-fill" style="width: ${Math.min(confWeighted * 2.5, 100)}%;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });
            }
            
            // Check if we need to update the DOM
            if (alertsContainer.innerHTML !== signalsHTML) {
                alertsContainer.innerHTML = signalsHTML;
                
                // If there are new signals, flash the first one
                if (filteredSignals.length > 0) {
                    const firstSignal = document.getElementById(`signal-${filteredSignals[0].id}`);
                    if (firstSignal) {
                        firstSignal.classList.add('flash-animation');
                    }
                }
            }
        }
        
        // Update statistics
        function updateStats(stats) {
            document.getElementById('totalSignals').textContent = stats.signal_count;
            document.getElementById('winRate').textContent = `${(stats.win_rate * 100).toFixed(1)}%`;
            document.getElementById('avgReturn').textContent = `${stats.avg_return.toFixed(2)}%`;
            
            if (signals.length > 0) {
                const lastSignalTime = new Date(signals[signals.length - 1].signal_time);
                document.getElementById('lastSignal').textContent = lastSignalTime.toLocaleTimeString();
            }
        }
        
        // Setup filter change
        document.getElementById('signalFilter').addEventListener('change', function() {
            updateSignals();
        });
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            setupChart();
            fetchData();
            
            // Auto-refresh data every 30 seconds
            setInterval(fetchData, 30000);
        });
    </script>
</body>
</html> 